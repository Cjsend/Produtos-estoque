<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- define codifica√ß√£o e t√≠tulo -->
  <meta charset="UTF-8">
  <title>Cadastro de Produtos</title>
  <!-- link para o CSS na pasta static -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- t√≠tulo da p√°gina -->
  <h1>üõí Cadastro de Produtos</h1>

  <!-- formul√°rio para cadastrar produtos
       enctype="multipart/form-data" √© necess√°rio para enviar arquivos (input type=file) -->
  <form id="form-produto" enctype="multipart/form-data">
    <!-- campo nome -->
    <input type="text" name="nome" placeholder="Nome do produto" required>
    <!-- campo pre√ßo (n√∫mero com duas casas) -->
    <input type="number" name="preco" placeholder="Pre√ßo" step="0.01" required>
    <!-- campo descri√ß√£o -->
    <textarea name="descricao" placeholder="Descri√ß√£o"></textarea>

    <!-- input para upload de arquivo local -->
    <label>Imagem (upload local):</label>
    <input type="file" name="imagem_arquivo" accept="image/*">

    <!-- alternativa: inserir URL da imagem -->
    <label>Ou imagem por URL:</label>
    <input type="text" name="imagem_url" placeholder="https://exemplo.com/imagem.jpg">

    <!-- bot√£o de enviar -->
    <button type="submit">Cadastrar</button>
  </form>

  <h2>Lista de Produtos</h2>
  <!-- container onde os cards de produto ser√£o inseridos dinamicamente -->
  <div id="lista"></div>

  <script>
    // pega refer√™ncias a elementos do DOM
    const form = document.getElementById('form-produto');
    const lista = document.getElementById('lista');

    // fun√ß√£o que busca produtos do back-end e renderiza na p√°gina
    async function carregarProdutos() {
      // chama a rota GET /produtos
      const res = await fetch('/produtos');
      // convierte resposta em JSON (array de produtos)
      const produtos = await res.json();

      // monta o HTML dos cards a partir do array de produtos
      lista.innerHTML = produtos.map(p => `
        <div class="card">
          <!-- exibe a imagem; se p.imagem for null/undefined usa placeholder -->
          <img src="${p.imagem || 'https://via.placeholder.com/150'}" alt="produto">
          <h3>${p.nome}</h3>
          <!-- mostra o pre√ßo ‚Äî nota: aqui n√£o formatamos casas decimais -->
          <p>R$ ${p.preco}</p>
          <p>${p.descricao || ''}</p>
          <!-- bot√£o excluir chama fun√ß√£o excluir passando o id -->
          <button onclick="excluir(${p.id})">Excluir</button>
        </div>
      `).join(''); // join para transformar array de strings em uma string s√≥
    }

    // listener para submiss√£o do formul√°rio
    form.addEventListener('submit', async (e) => {
      e.preventDefault(); // evita que o formul√°rio recarregue a p√°gina

      // FormData permite enviar texto + arquivos no mesmo request
      const dados = new FormData(form);

      // faz POST para /produtos com o body sendo o FormData
      await fetch('/produtos', { method: 'POST', body: dados });

      // limpa o formul√°rio
      form.reset();

      // recarrega a lista para mostrar o novo produto
      carregarProdutos();
    });

    // fun√ß√£o que deleta o produto por id
    async function excluir(id) {
      // chamada DELETE para /produtos/:id
      await fetch(`/produtos/${id}`, { method: 'DELETE' });
      // atualiza lista
      carregarProdutos();
    }

    // carrega os produtos ao abrir a p√°gina
    carregarProdutos();
  </script>
</body>
</html>
